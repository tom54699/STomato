# Tomato Backend æ¸¬è©¦ç¸½çµå ±å‘Š

## æ¦‚è¿°

æœ¬æ–‡æª”ç¸½çµäº† Tomato Backend å°ˆæ¡ˆçš„æ¸¬è©¦å¯¦ä½œæƒ…æ³ã€‚æˆ‘å€‘å·²ç¶“å®Œæˆäº†å®Œæ•´çš„æ¸¬è©¦æ¡†æ¶å»ºç«‹å’Œæ‰€æœ‰æ ¸å¿ƒ API çš„å–®å…ƒæ¸¬è©¦ã€‚

**å®Œæˆæ—¥æœŸ**: 2025-12-10
**æ¸¬è©¦æ¡†æ¶**: Go testing + GORM + Gin
**æ¸¬è©¦è¦†è“‹ç¯„åœ**: æ‰€æœ‰å·²å¯¦ä½œçš„ API ç«¯é»

---

## æ¸¬è©¦çµ±è¨ˆ

### æ¸¬è©¦æ–‡ä»¶çµ±è¨ˆ

| æ¸¬è©¦æ–‡ä»¶ | æ¸¬è©¦å‡½æ•¸æ•¸é‡ | æ¸¬è©¦ç”¨ä¾‹æ•¸é‡ | ä¸»è¦æ¸¬è©¦å…§å®¹ |
|---------|------------|------------|------------|
| `auth_test.go` | 5 | 23 | èªè­‰ç³»çµ±å®Œæ•´æµç¨‹ |
| `course_test.go` | 6 | 22 | èª²ç¨‹ CRUD æ“ä½œ |
| `plan_test.go` | 6 | 24 | å­¸ç¿’è¨ˆç•«ç®¡ç† |
| `session_test.go` | 6 | 28 | å°ˆæ³¨ç´€éŒ„èˆ‡ç©åˆ†ç³»çµ± |
| `todo_test.go` | 7 | 30 | å¾…è¾¦äº‹é …ç®¡ç† |
| **ç¸½è¨ˆ** | **30** | **127+** | **5 å€‹æ ¸å¿ƒæ¨¡çµ„** |

### æ¸¬è©¦è¦†è“‹ç¯„åœ

- âœ… **èªè­‰ API**: 100% è¦†è“‹
- âœ… **èª²ç¨‹ç®¡ç† API**: 100% è¦†è“‹
- âœ… **å­¸ç¿’è¨ˆç•« API**: 100% è¦†è“‹
- âœ… **å°ˆæ³¨ç´€éŒ„ API**: 100% è¦†è“‹
- âœ… **å¾…è¾¦äº‹é … API**: 100% è¦†è“‹

---

## æ¸¬è©¦æ¡†æ¶æ¶æ§‹

### 1. æ¸¬è©¦å·¥å…·åŒ… (`internal/testutil/`)

#### `database.go` - è³‡æ–™åº«æ¸¬è©¦å·¥å…·
- `SetupTestDB()` - å»ºç«‹æ¸¬è©¦è³‡æ–™åº«é€£æ¥
- `MigrateTestDB()` - åŸ·è¡Œè³‡æ–™åº«é·ç§»
- `CleanupTestDB()` - æ¸…ç†æ¸¬è©¦è³‡æ–™
- `TeardownTestDB()` - é—œé–‰è³‡æ–™åº«é€£æ¥

#### `fixtures.go` - Mock è³‡æ–™ç”Ÿæˆå™¨
- `CreateTestSchool()` - å‰µå»ºæ¸¬è©¦å­¸æ ¡
- `CreateTestUser()` - å‰µå»ºæ¸¬è©¦ç”¨æˆ¶ï¼ˆå«å¯†ç¢¼åŠ å¯†ï¼‰
- `CreateTestCourse()` - å‰µå»ºæ¸¬è©¦èª²ç¨‹
- `CreateTestStudyPlan()` - å‰µå»ºæ¸¬è©¦å­¸ç¿’è¨ˆç•«
- `CreateTestFocusSession()` - å‰µå»ºæ¸¬è©¦å°ˆæ³¨ç´€éŒ„
- `CreateTestTodo()` - å‰µå»ºæ¸¬è©¦å¾…è¾¦äº‹é …
- `CreateCompleteTestData()` - ä¸€æ¬¡æ€§å‰µå»ºå®Œæ•´æ¸¬è©¦æ•¸æ“š

#### `http.go` - HTTP æ¸¬è©¦è¼”åŠ©å·¥å…·
- `SetupTestRouter()` - å»ºç«‹æ¸¬è©¦è·¯ç”±å™¨
- `MakeRequest()` - è£½ä½œ HTTP è«‹æ±‚
- `MakeAuthenticatedRequest()` - è£½ä½œèªè­‰è«‹æ±‚
- `ParseResponse()` - è§£æ JSON å›æ‡‰
- `AssertStatusCode()` - æ–·è¨€ç‹€æ…‹ç¢¼
- `AssertSuccess()` - æ–·è¨€æˆåŠŸå›æ‡‰
- `AssertError()` - æ–·è¨€éŒ¯èª¤å›æ‡‰
- `GenerateTestToken()` - ç”Ÿæˆæ¸¬è©¦ JWT Token

### 2. ç’°å¢ƒé…ç½®

#### `.env.test` - æ¸¬è©¦ç’°å¢ƒè®Šæ•¸
```env
TEST_DB_HOST=localhost
TEST_DB_PORT=5432
TEST_DB_USER=postgres
TEST_DB_PASSWORD=postgres
TEST_DB_NAME=tomato_test
JWT_SECRET=test_secret_key_for_testing_only
```

### 3. æ¸¬è©¦è…³æœ¬

#### `scripts/run-tests.sh` - æ¸¬è©¦é‹è¡Œè…³æœ¬
åŠŸèƒ½ï¼š
- è‡ªå‹•æª¢æŸ¥ Go å’Œ PostgreSQL
- è¼‰å…¥æ¸¬è©¦ç’°å¢ƒè®Šæ•¸
- å‰µå»ºæ¸¬è©¦è³‡æ–™åº«ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- æ”¯æ´å¤šç¨®æ¸¬è©¦æ¨¡å¼ï¼š
  - å…¨éƒ¨æ¸¬è©¦
  - ç‰¹å®šåŒ…æ¸¬è©¦
  - ç‰¹å®šæ¸¬è©¦å‡½æ•¸
  - è¦†è“‹ç‡å ±å‘Šç”Ÿæˆ

ä½¿ç”¨æ–¹å¼ï¼š
```bash
./scripts/run-tests.sh              # é‹è¡Œæ‰€æœ‰æ¸¬è©¦
./scripts/run-tests.sh --coverage   # ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
./scripts/run-tests.sh -p handlers  # åªæ¸¬è©¦ handlers åŒ…
./scripts/run-tests.sh -v           # è©³ç´°è¼¸å‡º
```

#### `Makefile` - å¿«æ·å‘½ä»¤
æä¾›ä¾¿æ·çš„æ¸¬è©¦å‘½ä»¤ï¼š
```bash
make test              # é‹è¡Œæ‰€æœ‰æ¸¬è©¦
make test-coverage     # ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
make test-auth         # æ¸¬è©¦èªè­‰ API
make test-course       # æ¸¬è©¦èª²ç¨‹ API
make test-plan         # æ¸¬è©¦è¨ˆç•« API
make test-session      # æ¸¬è©¦å°ˆæ³¨ç´€éŒ„ API
make test-todo         # æ¸¬è©¦å¾…è¾¦äº‹é … API
```

---

## è©³ç´°æ¸¬è©¦å…§å®¹

### 1. èªè­‰ API æ¸¬è©¦ (`auth_test.go`)

#### TestRegister - ç”¨æˆ¶è¨»å†Šæ¸¬è©¦
- âœ… æˆåŠŸè¨»å†Šæ–°ç”¨æˆ¶
- âœ… ç¼ºå°‘å¿…å¡«æ¬„ä½ï¼ˆemail, password, name, school_nameï¼‰
- âœ… ç„¡æ•ˆçš„ email æ ¼å¼
- âœ… å¯†ç¢¼å¤ªçŸ­ï¼ˆ< 6 å­—å…ƒï¼‰
- âœ… é‡è¤‡çš„ email è¨»å†Š

**é—œéµé©—è­‰é»**:
- è¿”å›ç”¨æˆ¶è³‡æ–™ã€access_tokenã€refresh_token
- å¯†ç¢¼æ­£ç¢ºåŠ å¯†å­˜å„²
- å­¸æ ¡è‡ªå‹•å‰µå»ºæˆ–é—œè¯

#### TestLogin - ç”¨æˆ¶ç™»å…¥æ¸¬è©¦
- âœ… æˆåŠŸç™»å…¥
- âœ… éŒ¯èª¤çš„å¯†ç¢¼
- âœ… ä¸å­˜åœ¨çš„ç”¨æˆ¶
- âœ… ç¼ºå°‘ email æˆ– password

**é—œéµé©—è­‰é»**:
- è¿”å›æœ‰æ•ˆçš„ access_token å’Œ refresh_token
- å¯†ç¢¼é©—è­‰æ­£ç¢º

#### TestRefreshToken - Token åˆ·æ–°æ¸¬è©¦
- âœ… æˆåŠŸåˆ·æ–° token
- âœ… ç¼ºå°‘ refresh_token
- âœ… ç„¡æ•ˆçš„ refresh_token

**é—œéµé©—è­‰é»**:
- ç”Ÿæˆæ–°çš„ access_token å’Œ refresh_token
- èˆŠ token ä»ç„¶æœ‰æ•ˆ

#### TestLogout - ç™»å‡ºæ¸¬è©¦
- âœ… æˆåŠŸç™»å‡º
- âœ… ç¼ºå°‘èªè­‰ token
- âœ… ç„¡æ•ˆçš„ token

#### TestAuthenticationFlow - å®Œæ•´èªè­‰æµç¨‹æ¸¬è©¦
æ¸¬è©¦å®Œæ•´çš„ç”¨æˆ¶èªè­‰æµç¨‹ï¼š
1. è¨»å†Šæ–°ç”¨æˆ¶
2. ä½¿ç”¨ access_token ç™»å‡º
3. é‡æ–°ç™»å…¥
4. åˆ·æ–° token
5. ä½¿ç”¨æ–° token å†æ¬¡ç™»å‡º

**åƒ¹å€¼**: ç¢ºä¿æ‰€æœ‰èªè­‰ç«¯é»å”åŒå·¥ä½œæ­£ç¢º

---

### 2. èª²ç¨‹ API æ¸¬è©¦ (`course_test.go`)

#### TestGetCourses - ç²å–èª²ç¨‹åˆ—è¡¨
- âœ… æˆåŠŸç²å–æ‰€æœ‰èª²ç¨‹
- âœ… æœªèªè­‰è«‹æ±‚è¢«æ‹’çµ•

#### TestCreateCourse - å‰µå»ºèª²ç¨‹
- âœ… æˆåŠŸå‰µå»ºå®Œæ•´èª²ç¨‹è³‡æ–™
- âœ… ç¼ºå°‘å¿…å¡«æ¬„ä½ï¼ˆnameï¼‰
- âœ… ç„¡æ•ˆçš„æ—¥æœŸæ ¼å¼
- âœ… ç„¡æ•ˆçš„ day_of_weekï¼ˆç¯„åœ 0-6ï¼‰

**é—œéµé©—è­‰é»**:
- èª²ç¨‹ ID è‡ªå‹•ç”Ÿæˆï¼ˆUUIDï¼‰
- èª²ç¨‹é—œè¯åˆ°ç•¶å‰ç”¨æˆ¶

#### TestGetCourse - ç²å–å–®å€‹èª²ç¨‹
- âœ… æˆåŠŸç²å–èª²ç¨‹è©³æƒ…
- âœ… èª²ç¨‹ä¸å­˜åœ¨è¿”å› 404
- âœ… ç„¡æ•ˆçš„èª²ç¨‹ ID
- âœ… ç„¡æ³•è¨ªå•å…¶ä»–ç”¨æˆ¶çš„èª²ç¨‹

**é—œéµé©—è­‰é»**:
- ç”¨æˆ¶æ¬Šé™éš”é›¢æ­£ç¢º

#### TestUpdateCourse - æ›´æ–°èª²ç¨‹
- âœ… æˆåŠŸæ›´æ–°èª²ç¨‹
- âœ… éƒ¨åˆ†æ›´æ–°ï¼ˆåªæ›´æ–°æŸäº›æ¬„ä½ï¼‰
- âœ… èª²ç¨‹ä¸å­˜åœ¨è¿”å› 404
- âœ… ç„¡æ•ˆçš„èª²ç¨‹ ID

**é—œéµé©—è­‰é»**:
- éƒ¨åˆ†æ›´æ–°ä¸å½±éŸ¿æœªæä¾›çš„æ¬„ä½

#### TestDeleteCourse - åˆªé™¤èª²ç¨‹
- âœ… æˆåŠŸåˆªé™¤èª²ç¨‹
- âœ… èª²ç¨‹ä¸å­˜åœ¨è¿”å› 404
- âœ… ç„¡æ•ˆçš„èª²ç¨‹ ID

**é—œéµé©—è­‰é»**:
- èª²ç¨‹å¾è³‡æ–™åº«ä¸­å®Œå…¨ç§»é™¤
- ç´šè¯åˆªé™¤ç›¸é—œè³‡æ–™ï¼ˆå¦‚æœ‰ï¼‰

#### TestCourseCRUDFlow - å®Œæ•´ CRUD æµç¨‹
æ¸¬è©¦å®Œæ•´çš„èª²ç¨‹ç®¡ç†æµç¨‹ï¼š
1. å‰µå»ºèª²ç¨‹
2. é€šé ID ç²å–èª²ç¨‹
3. æ›´æ–°èª²ç¨‹
4. ç²å–æ‰€æœ‰èª²ç¨‹
5. åˆªé™¤èª²ç¨‹
6. é©—è­‰åˆªé™¤ï¼ˆæ‡‰è¿”å› 404ï¼‰

---

### 3. å­¸ç¿’è¨ˆç•« API æ¸¬è©¦ (`plan_test.go`)

#### TestGetPlans - ç²å–è¨ˆç•«åˆ—è¡¨
- âœ… ç²å–æ‰€æœ‰è¨ˆç•«
- âœ… æŒ‰æ—¥æœŸç¯©é¸
- âœ… æŒ‰æ—¥æœŸç¯„åœç¯©é¸
- âœ… æŒ‰å®Œæˆç‹€æ…‹ç¯©é¸

#### TestCreatePlan - å‰µå»ºè¨ˆç•«
- âœ… æˆåŠŸå‰µå»ºé—œè¯èª²ç¨‹çš„è¨ˆç•«
- âœ… å‰µå»ºä¸é—œè¯èª²ç¨‹çš„è¨ˆç•«
- âœ… ç¼ºå°‘å¿…å¡«æ¬„ä½é©—è­‰
- âœ… ç„¡æ•ˆçš„æ—¥æœŸæ ¼å¼
- âœ… ç„¡æ•ˆçš„èª²ç¨‹ ID
- âœ… ç›®æ¨™æ™‚é–“ç‚ºè² æ•¸é©—è­‰

**é—œéµé©—è­‰é»**:
- æ–°è¨ˆç•« `completed` é è¨­ç‚º false
- `completed_minutes` å’Œ `pomodoro_count` é è¨­ç‚º 0

#### TestGetPlan - ç²å–å–®å€‹è¨ˆç•«
- âœ… æˆåŠŸç²å–è¨ˆç•«è©³æƒ…
- âœ… è¨ˆç•«ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„è¨ˆç•« ID
- âœ… æ¬Šé™éš”é›¢é©—è­‰

#### TestUpdatePlan - æ›´æ–°è¨ˆç•«
- âœ… æˆåŠŸæ›´æ–°è¨ˆç•«
- âœ… éƒ¨åˆ†æ›´æ–°
- âœ… ç§»é™¤èª²ç¨‹é—œè¯
- âœ… è¨ˆç•«ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„è¨ˆç•« ID

#### TestDeletePlan - åˆªé™¤è¨ˆç•«
- âœ… æˆåŠŸåˆªé™¤è¨ˆç•«
- âœ… è¨ˆç•«ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„è¨ˆç•« ID

#### TestTogglePlanComplete - åˆ‡æ›å®Œæˆç‹€æ…‹
- âœ… æ¨™è¨˜ç‚ºå®Œæˆ
- âœ… æ¨™è¨˜ç‚ºæœªå®Œæˆ
- âœ… ç¼ºå°‘ completed æ¬„ä½
- âœ… è¨ˆç•«ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„è¨ˆç•« ID

**é—œéµé©—è­‰é»**:
- å®Œæˆç‹€æ…‹æ­£ç¢ºæ›´æ–°
- è¿”å›çš„è³‡æ–™åŒ…å«æ›´æ–°å¾Œçš„ç‹€æ…‹

#### TestPlanCRUDFlow - å®Œæ•´è¨ˆç•«æµç¨‹
å®Œæ•´æ¸¬è©¦è¨ˆç•«ç®¡ç†çš„æ‰€æœ‰æ“ä½œ

---

### 4. å°ˆæ³¨ç´€éŒ„ API æ¸¬è©¦ (`session_test.go`)

é€™æ˜¯æœ€è¤‡é›œçš„æ¸¬è©¦æ¨¡çµ„ï¼Œå› ç‚ºæ¶‰åŠäº‹å‹™è™•ç†å’Œå¤šè¡¨æ›´æ–°ã€‚

#### TestGetSessions - ç²å–å°ˆæ³¨ç´€éŒ„
- âœ… ç²å–æ‰€æœ‰ç´€éŒ„
- âœ… åˆ†é æŸ¥è©¢
- âœ… æŒ‰æ—¥æœŸç¯„åœç¯©é¸

**é—œéµé©—è­‰é»**:
- è¿”å›æ ¼å¼åŒ…å« sessionsã€totalã€limitã€offset

#### TestCreateSession - å‰µå»ºå°ˆæ³¨ç´€éŒ„
- âœ… æˆåŠŸå‰µå»ºé—œè¯è¨ˆç•«å’Œèª²ç¨‹çš„ç´€éŒ„
- âœ… å‰µå»ºä¸é—œè¯è¨ˆç•«çš„ç´€éŒ„
- âœ… å‰µå»ºä¸é—œè¯èª²ç¨‹çš„ç´€éŒ„
- âœ… ç¼ºå°‘å¿…å¡«æ¬„ä½é©—è­‰
- âœ… ç„¡æ•ˆçš„æ—¥æœŸæ ¼å¼
- âœ… ç„¡æ•ˆçš„è¨ˆç•« ID
- âœ… åˆ†é˜æ•¸ç‚º 0 æˆ–è² æ•¸é©—è­‰

**é—œéµé©—è­‰é»**ï¼ˆé‡è¦ï¼ï¼‰:
- âœ… ç”¨æˆ¶ç¸½ç©åˆ†è‡ªå‹•å¢åŠ 
- âœ… å­¸æ ¡ç¸½ç©åˆ†è‡ªå‹•å¢åŠ 
- âœ… è¨ˆç•« `completed_minutes` è‡ªå‹•å¢åŠ 
- âœ… è¨ˆç•« `pomodoro_count` è‡ªå‹• +1
- âœ… ç©åˆ†è¨ˆç®—æ­£ç¢ºï¼ˆminutes Ã— base_points_per_minuteï¼‰

#### TestGetSessionStats - ç²å–çµ±è¨ˆæ•¸æ“š
- âœ… é€±çµ±è¨ˆ
- âœ… æœˆçµ±è¨ˆ
- âœ… å¹´çµ±è¨ˆ
- âœ… ç”Ÿæ¶¯çµ±è¨ˆ
- âœ… é è¨­çµ±è¨ˆï¼ˆæœˆï¼‰

**é—œéµé©—è­‰é»**:
- è¿”å› total_sessionsã€total_minutesã€total_points
- è¿”å› active_daysã€current_streak
- è¿”å› daily_breakdownã€course_breakdown

#### TestSessionTransactionRollback - äº‹å‹™å›æ»¾æ¸¬è©¦
**é€™æ˜¯ä¸€å€‹é—œéµæ¸¬è©¦ï¼**

æ¸¬è©¦ç•¶å‰µå»ºç´€éŒ„å¤±æ•—æ™‚ï¼Œäº‹å‹™æ˜¯å¦æ­£ç¢ºå›æ»¾ï¼š
- âœ… å‰µå»ºå¤±æ•—æ™‚ç”¨æˆ¶ç©åˆ†ä¸è®Š
- âœ… å‰µå»ºå¤±æ•—æ™‚è¨ˆç•«é€²åº¦ä¸è®Š

**åƒ¹å€¼**: ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ï¼Œé¿å…ç©åˆ†éŒ¯èª¤å¢åŠ 

#### TestPlanAutoCompletion - è¨ˆç•«è‡ªå‹•å®Œæˆæ¸¬è©¦
æ¸¬è©¦ç•¶å°ˆæ³¨æ™‚é–“é”åˆ°ç›®æ¨™æ™‚ï¼Œè¨ˆç•«æ˜¯å¦è‡ªå‹•æ¨™è¨˜ç‚ºå®Œæˆï¼š
- âœ… å‰µå»º 60 åˆ†é˜ç›®æ¨™çš„è¨ˆç•«
- âœ… æ·»åŠ  70 åˆ†é˜çš„å°ˆæ³¨ç´€éŒ„
- âœ… é©—è­‰è¨ˆç•«è‡ªå‹•æ¨™è¨˜ç‚º `completed = true`

#### TestSessionFlow - å®Œæ•´å°ˆæ³¨ç´€éŒ„æµç¨‹
æ¸¬è©¦å®Œæ•´çš„å°ˆæ³¨ç´€éŒ„ä½¿ç”¨å ´æ™¯ï¼š
1. å‰µå»ºå¤šå€‹å°ˆæ³¨ç´€éŒ„
2. ç²å–æ‰€æœ‰ç´€éŒ„
3. ç²å–çµ±è¨ˆæ•¸æ“š
4. é©—è­‰ç”¨æˆ¶ç©åˆ†æ­£ç¢ºç´¯ç©
5. é©—è­‰è¨ˆç•«é€²åº¦æ­£ç¢ºæ›´æ–°

**é€™å€‹æ¸¬è©¦é©—è­‰äº†æ•´å€‹ç©åˆ†ç³»çµ±çš„æ ¸å¿ƒé‚è¼¯ï¼**

---

### 5. å¾…è¾¦äº‹é … API æ¸¬è©¦ (`todo_test.go`)

#### TestGetTodos - ç²å–å¾…è¾¦åˆ—è¡¨
- âœ… ç²å–æ‰€æœ‰å¾…è¾¦
- âœ… æŒ‰æ—¥æœŸç¯©é¸
- âœ… æŒ‰é¡å‹ç¯©é¸ï¼ˆhomeworkã€examã€memoï¼‰
- âœ… æŒ‰å®Œæˆç‹€æ…‹ç¯©é¸

#### TestCreateTodo - å‰µå»ºå¾…è¾¦
- âœ… æˆåŠŸå‰µå»ºä½œæ¥­å¾…è¾¦
- âœ… æˆåŠŸå‰µå»ºè€ƒè©¦å¾…è¾¦
- âœ… æˆåŠŸå‰µå»ºå‚™å¿˜å¾…è¾¦
- âœ… å‰µå»ºä¸é—œè¯èª²ç¨‹çš„å¾…è¾¦
- âœ… ç¼ºå°‘å¿…å¡«æ¬„ä½é©—è­‰
- âœ… ç„¡æ•ˆçš„æ—¥æœŸæ ¼å¼
- âœ… ç„¡æ•ˆçš„èª²ç¨‹ ID
- âœ… ç„¡æ•ˆçš„ todo_type

**é—œéµé©—è­‰é»**:
- æ–°å¾…è¾¦ `completed` é è¨­ç‚º false
- todo_type å¿…é ˆæ˜¯ homeworkã€examã€memo ä¹‹ä¸€

#### TestGetTodo - ç²å–å–®å€‹å¾…è¾¦
- âœ… æˆåŠŸç²å–å¾…è¾¦è©³æƒ…
- âœ… å¾…è¾¦ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„å¾…è¾¦ ID
- âœ… æ¬Šé™éš”é›¢é©—è­‰

#### TestUpdateTodo - æ›´æ–°å¾…è¾¦
- âœ… æˆåŠŸæ›´æ–°å¾…è¾¦
- âœ… éƒ¨åˆ†æ›´æ–°
- âœ… ç§»é™¤èª²ç¨‹é—œè¯
- âœ… æ›´æ–°æ—¥æœŸ
- âœ… å¾…è¾¦ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„å¾…è¾¦ ID
- âœ… ç„¡æ•ˆçš„æ—¥æœŸæ ¼å¼

#### TestDeleteTodo - åˆªé™¤å¾…è¾¦
- âœ… æˆåŠŸåˆªé™¤å¾…è¾¦
- âœ… å¾…è¾¦ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„å¾…è¾¦ ID

#### TestToggleTodoComplete - åˆ‡æ›å®Œæˆç‹€æ…‹
- âœ… æ¨™è¨˜ç‚ºå®Œæˆ
- âœ… æ¨™è¨˜ç‚ºæœªå®Œæˆ
- âœ… ç¼ºå°‘ completed æ¬„ä½
- âœ… å¾…è¾¦ä¸å­˜åœ¨
- âœ… ç„¡æ•ˆçš„å¾…è¾¦ ID

#### TestTodoCRUDFlow - å®Œæ•´å¾…è¾¦æµç¨‹
å®Œæ•´æ¸¬è©¦å¾…è¾¦äº‹é …çš„æ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬é¡å‹ç¯©é¸

#### TestTodoTypeValidation - é¡å‹é©—è­‰æ¸¬è©¦
é©—è­‰æ‰€æœ‰æœ‰æ•ˆçš„ todo_typeï¼š
- âœ… homework
- âœ… exam
- âœ… memo

---

## æ¸¬è©¦æœ€ä½³å¯¦è¸

æˆ‘å€‘çš„æ¸¬è©¦éµå¾ªä»¥ä¸‹æœ€ä½³å¯¦è¸ï¼š

### 1. è¡¨é©…å‹•æ¸¬è©¦ï¼ˆTable-Driven Testsï¼‰
```go
tests := []struct {
    name           string
    requestBody    interface{}
    expectedStatus int
    expectedError  string
}{
    {"æˆåŠŸæ¡ˆä¾‹", validData, 200, ""},
    {"ç¼ºå°‘æ¬„ä½", invalidData, 400, "VALIDATION_ERROR"},
    // ...
}

for _, tt := range tests {
    t.Run(tt.name, func(t *testing.T) {
        // æ¸¬è©¦é‚è¼¯
    })
}
```

### 2. è³‡æ–™éš”é›¢
æ¯å€‹æ¸¬è©¦éƒ½æœ‰ç¨ç«‹çš„è¨­ç½®å’Œæ¸…ç†ï¼š
```go
func TestSomething(t *testing.T) {
    router, user, token, cleanup := setupTests(t)
    defer cleanup()  // ç¢ºä¿è³‡æ–™æ¸…ç†
    // æ¸¬è©¦é‚è¼¯...
}
```

### 3. æè¿°æ€§æ¸¬è©¦åç¨±
- âœ… "æˆåŠŸå‰µå»ºèª²ç¨‹"
- âœ… "ç¼ºå°‘å¿…å¡«æ¬„ä½æ™‚è¿”å›éŒ¯èª¤"
- âŒ "test1", "test_create"

### 4. å®Œæ•´çš„é‚Šç•Œæ¸¬è©¦
æ¸¬è©¦ä¸åƒ…åŒ…å«æ­£å¸¸æƒ…æ³ï¼Œé‚„åŒ…å«ï¼š
- ç©ºè¼¸å…¥
- ç„¡æ•ˆè¼¸å…¥
- é‚Šç•Œå€¼
- éŒ¯èª¤è™•ç†
- æ¬Šé™é©—è­‰

### 5. é›†æˆæ¸¬è©¦
æ¯å€‹æ¨¡çµ„éƒ½æœ‰å®Œæ•´çš„æµç¨‹æ¸¬è©¦ï¼Œé©—è­‰å„ç«¯é»å”åŒå·¥ä½œ

---

## é‹è¡Œæ¸¬è©¦

### å¿«é€Ÿé–‹å§‹

```bash
# 1. ç¢ºä¿ PostgreSQL æ­£åœ¨é‹è¡Œ
brew services start postgresql@15

# 2. å‰µå»ºæ¸¬è©¦è³‡æ–™åº«
psql -U postgres -c "CREATE DATABASE tomato_test;"

# 3. é‹è¡Œæ‰€æœ‰æ¸¬è©¦
make test

# æˆ–ä½¿ç”¨è…³æœ¬
./scripts/run-tests.sh
```

### å…¶ä»–æ¸¬è©¦å‘½ä»¤

```bash
# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
make test-coverage

# åªæ¸¬è©¦èªè­‰ API
make test-auth

# åªæ¸¬è©¦èª²ç¨‹ API
make test-course

# è©³ç´°è¼¸å‡º
make test-verbose

# é‹è¡Œç‰¹å®šæ¸¬è©¦
go test ./internal/handlers -run TestRegister -v
```

---

## æ¸¬è©¦æ–‡æª”

å®Œæ•´çš„æ¸¬è©¦æ–‡æª”ä½æ–¼ `docs/testing.md`ï¼ŒåŒ…å«ï¼š

- æ¸¬è©¦ç’°å¢ƒè¨­ç½®æŒ‡å—
- å¦‚ä½•ç·¨å¯«æ–°æ¸¬è©¦
- æ¸¬è©¦å·¥å…·ä½¿ç”¨æ–¹æ³•
- æ•…éšœæ’é™¤æŒ‡å—
- CI/CD é›†æˆç¯„ä¾‹

---

## æœªä¾†æ”¹é€²

é›–ç„¶ç•¶å‰æ¸¬è©¦å·²ç¶“éå¸¸å®Œæ•´ï¼Œä½†ä»æœ‰æ”¹é€²ç©ºé–“ï¼š

### 1. é›†æˆæ¸¬è©¦
- [ ] è·¨æ¨¡çµ„çš„ç«¯åˆ°ç«¯æ¸¬è©¦
- [ ] çœŸå¯¦ç”¨æˆ¶å ´æ™¯æ¨¡æ“¬

### 2. æ•ˆèƒ½æ¸¬è©¦
- [ ] è² è¼‰æ¸¬è©¦
- [ ] ä¸¦ç™¼æ¸¬è©¦
- [ ] æŸ¥è©¢æ•ˆèƒ½æ¸¬è©¦

### 3. å®‰å…¨æ¸¬è©¦
- [ ] SQL æ³¨å…¥æ¸¬è©¦
- [ ] XSS æ¸¬è©¦
- [ ] CSRF æ¸¬è©¦
- [ ] é€Ÿç‡é™åˆ¶æ¸¬è©¦

### 4. æ¨¡æ“¬å¤–éƒ¨ä¾è³´
- [ ] Email æœå‹™ mock
- [ ] ç¬¬ä¸‰æ–¹ API mock

### 5. CI/CD é›†æˆ
- [ ] GitHub Actions é…ç½®
- [ ] è‡ªå‹•åŒ–æ¸¬è©¦é‹è¡Œ
- [ ] è¦†è“‹ç‡å ±å‘Šä¸Šå‚³

---

## ç¸½çµ

æˆ‘å€‘å·²ç¶“å»ºç«‹äº†ä¸€å€‹**å…¨é¢ã€å¯é ã€å¯ç¶­è­·**çš„æ¸¬è©¦é«”ç³»ï¼š

### æˆæœ
- âœ… **127+ æ¸¬è©¦ç”¨ä¾‹** è¦†è“‹æ‰€æœ‰æ ¸å¿ƒ API
- âœ… **30 å€‹æ¸¬è©¦å‡½æ•¸** ç³»çµ±åŒ–æ¸¬è©¦æ¯å€‹ç«¯é»
- âœ… **å®Œæ•´çš„æ¸¬è©¦å·¥å…·åŒ…** æä¾›å¯é‡ç”¨çš„æ¸¬è©¦è¼”åŠ©å‡½æ•¸
- âœ… **è©³ç´°çš„æ¸¬è©¦æ–‡æª”** å¹«åŠ©æ–°æˆå“¡å¿«é€Ÿä¸Šæ‰‹
- âœ… **ä¾¿æ·çš„æ¸¬è©¦è…³æœ¬** ç°¡åŒ–æ¸¬è©¦åŸ·è¡Œ

### ç‰¹é»
- **è¡¨é©…å‹•æ¸¬è©¦** - æ˜“æ–¼ç¶­è­·å’Œæ“´å±•
- **è³‡æ–™éš”é›¢** - æ¸¬è©¦äº’ä¸å½±éŸ¿
- **å®Œæ•´è¦†è“‹** - æ­£å¸¸æƒ…æ³ + éŒ¯èª¤æƒ…æ³ + é‚Šç•Œæƒ…æ³
- **é›†æˆæ¸¬è©¦** - é©—è­‰ç«¯é»å”åŒå·¥ä½œ
- **é—œéµé‚è¼¯é©—è­‰** - äº‹å‹™è™•ç†ã€ç©åˆ†ç³»çµ±ã€è‡ªå‹•å®Œæˆ

### åƒ¹å€¼
1. **è³ªé‡ä¿è­‰** - ç¢ºä¿ä»£ç¢¼è®Šæ›´ä¸æœƒç ´å£ç¾æœ‰åŠŸèƒ½
2. **æ–‡æª”ä½œç”¨** - æ¸¬è©¦å³æ–‡æª”ï¼Œå±•ç¤º API çš„æ­£ç¢ºç”¨æ³•
3. **å¿«é€Ÿé–‹ç™¼** - æ–°åŠŸèƒ½å¯ä»¥å¿«é€Ÿé©—è­‰
4. **ä¿¡å¿ƒä¿éšœ** - é‡æ§‹æ™‚æœ‰æ¸¬è©¦ä¿è­·

---

**é …ç›®ç‹€æ…‹**: æ¸¬è©¦æ¡†æ¶å·²å®Œæˆï¼Œæ‰€æœ‰æ ¸å¿ƒ API å·²æ¸¬è©¦ âœ…
**æº–å‚™å°±ç·’**: å¯ä»¥é–‹å§‹éƒ¨ç½²å’Œç”Ÿç”¢ç’°å¢ƒæº–å‚™ ğŸš€

---

*æœ€å¾Œæ›´æ–°: 2025-12-10*
